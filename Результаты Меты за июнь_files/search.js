var debouncedFindPosts=_.debounce(findPosts,1e3),posts=[];function countImages(t){return t?(t.match(/<img(.|\n)*?>/g)||[]).length:0}function countWords(t){if(!t)return 0;var e=(t=t.replace(/<(.|\n)*?>/g," ")).match(/[a-zA-ZÀ-ÿ0-9_\u0392-\u03c9\u0410-\u04F9]+|[\u4E00-\u9FFF\u3400-\u4dbf\uf900-\ufaff\u3040-\u309f\uac00-\ud7af]+/g),n=0;if(null===e)return n;for(var s=0;s<e.length;s+=1)19968<=e[s].charCodeAt(0)?n+=e[s].length:n+=1;return n}function estimatedReadingTimeInMinutes(t){for(var e=t.wordCount,n=t.imageCount,s=e/(275/60),a=12;12-n<a;a-=1)s+=Math.max(a,3);return Math.round(s/60)}function readingTime(t,e){e=e||{};var n=t.html,s="string"==typeof e.minute?e.minute:"1 min read",a="string"==typeof e.minutes?e.minutes:"% min read";if(!n)return"";var r=countImages(n),i=countWords(n);t.feature_image&&(r+=1);var o=estimatedReadingTimeInMinutes({wordCount:i,imageCount:r});return o<=1?s:a.replace("%",o)}var months=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],days=[];function formatDate(t){var e=new Date(t),n=e.getDate(),s=e.getMonth();return n+" "+months[s]}var englishRussianSupport=lunr.multiLanguage("en","ru");function getPosts(){return posts.length?Promise.resolve(posts):api.posts.browse({limit:"all",include:["tags"]}).then(function(t){return posts=t})}function findPosts(n){getPosts().then(function(e){var t=lunr(function(){this.use(englishRussianSupport),this.ref("id"),this.field("title"),this.field("text"),this.field("html"),this.field("url"),e.forEach(function(t){this.add(t)},this)}).search(n+"* "+n).map(function(t){return _.find(e,{id:t.ref})}).map(function(t){return'<article class="post post-card">        <span class="post-data">          <span>'+t.primary_tag.name+'</span>          <span class="reading-time">'+readingTime(t)+'</span>, <time class="post-date" datetime="">          '+formatDate(t.updated_at)+'          </time>        </span>        <div class="post-card-content">          <a class="post-card-content-link no-styles-link" href="'+t.url+'">            <header class="post-card-header">                <h2 class="post-card-title">'+t.title+'</h2>            </header>            <section class="post-card-excerpt">              <p>'+t.excerpt.split(" ").slice(0,33).join(" ")+"...</p>            </section>          </a>        </div>      </article>"});$(".search-results").html('<div class="search-phrase">Результаты поиска по запросу «'+n+"»</div>"+t.join("")),translateReadingTime()}).catch(function(t){console.error("error",t)})}$(".header-search").find(".icon-button").on("click",function(){debouncedFindPosts.flush()}),$(".header-search-input").on("input",function(t){var e=t.target.value,n=$(".search-results");if(!e.length)return n.html(""),n.next().removeClass("search-enabled"),void debouncedFindPosts.cancel();n.next().addClass("search-enabled"),n.html('<div class="search-phrase">Результаты поиска по запросу «'+e+"»</div>"),debouncedFindPosts(e)}),$(document).ready(function(){$("#site-main").prepend('<div class="search-results col-xs-12 col-sm-offset-2 col-sm-8 col-md-offset-3 col-md-6"></div>')});
//# sourceMappingURL=search.js.map